<div class="panel">
  <div class="panel-header">
    <operation-entities-header></operation-entities-header>
  </div>
  <div>
    <div *ngFor="let governingEntity of entities$ | async; let idx = index;" class="form-check form-check-inline">
      <div *ngIf="governingEntity.selected">
        <input class="form-check-input"
          type="radio"
          [(ngModel)]="operation.viewingGoverningEntityIdx"
          [value]="idx"
          (change)="selectNewGoverningEntity(operation, idx)"
          name="operationClusterVisible"
          id="operationCluster-{{governingEntity.governingEntityVersion.name}}"/>
        <label for="operationCluster-{{governingEntity.governingEntityVersion.name}}" class="form-check-label">
          <figure class="figure">
            <img *ngIf="governingEntity.governingEntityVersion.value.icon && governingEntity.governingEntityVersion.value.icon.length"
              class="clusterImg"
              src="/assets/images/fieldClusters/SVG/{{governingEntity.governingEntityVersion.value.icon}}.svg" title="{{governingEntity.governingEntityVersion.name}}">
              <figcaption class="figure-caption cluster-label">{{ governingEntity.name }}
                <i class="material-icons" *ngIf="governingEntity.selectedCount">check</i>
              </figcaption>
            </figure>
        </label>
      </div>
    </div>
  </div>

  <div class="panel-body">
    <form>
      <div *ngIf="(mode$ | async) mode" class="panel-entities">
        <entity-entry *ngIf="entity"></entity-entry>
        <entity-entry *ngIf="!entity && mode === 'add'"></entity-entry>
      </div>
      <div *ngIf="(entityPrototype$ | async) as entityPrototype" class="panel-actions">
        <button [disabled]="!isAddButtonEnabled()"
            mat-raised-button (click)="addEntity()">
          {{ 'Add ' + entityPrototype.value.name.en.singular }}
        </button>
      </div>
    </form>
  </div>
</div>
