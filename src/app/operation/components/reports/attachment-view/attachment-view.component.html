<div class="form-panel">
  <div class="form-title">
    <i (click)="toggleExpand()" *ngIf="!expanded" class="material-icons">chevron_right</i>
    <i (click)="toggleExpand()" *ngIf="expanded" class="material-icons">expand_more</i>
    <span class="form-title">{{title}}</span>
    <div class="status">{{status}}</div>
  </div>
  <div *ngIf="expanded" class="form-body">
    <div class="form-content">
      <form [formGroup]="registerForm">
        <fieldset>
          <div class="title"><b>Reporting Period</b></div>
          <div class="row dates">
            <div class="form-group col-lg-4 flex-row date">
              <div class="label"><label for="reportFrom" translate="From"></label></div>
              <div class="input-group">
                <input readonly
                  id="reportFrom"
                  name="reportFrom"
                  formControlName="reportFrom">
              </div>
            </div>
            <div class="form-group col-lg-4 flex-row date">
              <div class="label"><label for="reportTo" translate="To"></label></div>
              <div class="input-group">
                <input class="form-control"
                  id="reportTo"
                  name="reportTo"
                  formControlName="reportTo">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="form-group col-lg-12">
              <label for="file" translate>Data</label>
              <input class="form-control" type="text" id="file" disabled
                formControlName="filename"/>
              <button *ngIf="!(operation.report && operation.report.finalized) && !submissions.tempSubmission && !submissions.submission" (click)="openForm(templateCreate)" type="button" class="btn btn-default openform">
                  {{ 'Open Form' | translate }}
              </button>
              <button *ngIf="!(operation.report && operation.report.finalized) && submissions.tempSubmission" (click)="openForm(templateEdit)" type="button" class="btn btn-default openform">
                  {{ 'Edit Form' | translate }}
              </button>
              <button *ngIf="operation.report && operation.report.finalized" (click)="openForm(templateEdit)" type="button" class="btn btn-default openform">
                  {{ 'View Form' | translate }}
              </button>
            </div>
          </div>
          <div class="row">
            <div class="form-group col-lg-12">
              <label for="comments" translate="">Comments</label>
              <textarea disabled *ngIf="operation.report && operation.report.finalized" class="form-control"  formControlName="comments"
                type="text" id="comments" name="comments"></textarea>
              <textarea *ngIf="!(operation.report && operation.report.finalized)" class="form-control"  formControlName="comments"
                type="text" id="comments" name="comments"></textarea>
            </div>
          </div>
          <div class="row message">
            <div class="form-group col-lg-12">
              <div *ngIf="!(operation.report && operation.report.finalized)">
                Click "Save" to save your changes. Until finalised, you can return to the form at any time to make further edits. Click "Save and Finalise" to submit your data. Once you click finalise, you will no longer be able to make further changes.
              </div>
              <div *ngIf="operation.report && operation.report.finalized">
                The form has been finalised. No further changes are possible.
              </div>
            </div>
          </div>
        </fieldset>
      </form>
    </div>
    <div *ngIf="!(operation.report && operation.report.finalized)" class="form-actions">
      <button [disabled]="!submissions.tempSubmission" type="button" class="btn btn-save" (click)="saveAndFinalize(false)">
        {{ 'Save' | translate }}
      </button>
      <button [disabled]="!submissions.tempSubmission" type="button" class="btn btn-primary" (click)="saveAndFinalize(true)">
        {{ 'Save and Finalise' | translate }}
      </button>
    </div>
  </div>
</div>

<ng-template #templateCreate>
  <div class="modal-header">
    <h4 class="modal-title pull-left">{{entry.formName}}</h4>
    <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <enketo-form formId="{{entry.formFile.filepath}}"></enketo-form>
  </div>
</ng-template>
<ng-template #templateEdit>
  <div class="modal-header">
    <h4 class="modal-title pull-left">{{entry.formName}}{{entry.id}}</h4>
    <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <enketo-form formId="{{entry.formFile.filepath}}" submissionId="{{entry.id}}" editable="{{!(operation.report && operation.report.finalized)}}"></enketo-form>
  </div>
</ng-template>
